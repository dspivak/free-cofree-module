\documentclass[11pt, one side, article]{memoir}


\settrims{0pt}{0pt} % page and stock same size
\settypeblocksize{*}{34.5pc}{*} % {height}{width}{ratio}
\setlrmargins{*}{*}{1} % {spine}{edge}{ratio}
\setulmarginsandblock{.98in}{.98in}{*} % height of typeblock computed
\setheadfoot{\onelineskip}{2\onelineskip} % {headheight}{footskip}
\setheaderspaces{*}{1.5\onelineskip}{*} % {headdrop}{headsep}{ratio}
\checkandfixthelayout


\usepackage{amsthm}
\usepackage{mathtools}

\usepackage[inline]{enumitem}
\usepackage{ifthen}
\usepackage[utf8]{inputenc} %allows non-ascii in bib file
\usepackage{xcolor}

\usepackage[backend=biber, backref=true, maxbibnames = 10, style = alphabetic]{biblatex}
\usepackage[bookmarks=true, colorlinks=true, linkcolor=blue!50!black,
citecolor=orange!50!black, urlcolor=orange!50!black, pdfencoding=unicode]{hyperref}
\usepackage[capitalize]{cleveref}

\usepackage{tikz}

\usepackage{amssymb}
\usepackage{newpxtext}
\usepackage[varg,bigdelims]{newpxmath}
\usepackage{mathrsfs}
\usepackage{dutchcal}
\usepackage{fontawesome}

% xcolor %

\definecolor{dgreen}{rgb}{0.0, 0.5, 0.3} 
\definecolor{dyellow}{rgb}{8.0, 0.74, 0}

% cleveref %
  \newcommand{\creflastconjunction}{, and\nobreakspace} % serial comma
  \crefformat{enumi}{\##2#1#3}
  \crefalias{chapter}{section}


% biblatex %
  \addbibresource{Library20230428.bib} 

% hyperref %
  \hypersetup{final}

% enumitem %
  \setlist{nosep}
  \setlistdepth{6}




% tikz %



  \usetikzlibrary{ 
  	cd,
  	math,
  	decorations.markings,
		decorations.pathreplacing,
  	positioning,
  	arrows.meta,
  	shapes,
		shadows,
		shadings,
  	calc,
  	fit,
  	quotes,
  	intersections,
    circuits,
    circuits.ee.IEC
  }
  
  \tikzset{
biml/.tip={Glyph[glyph math command=triangleleft, glyph length=.95ex]},
bimr/.tip={Glyph[glyph math command=triangleright, glyph length=.95ex]},
}

\tikzset{
	tick/.style={postaction={
  	decorate,
    decoration={markings, mark=at position 0.5 with
    	{\draw[-] (0,.4ex) -- (0,-.4ex);}}}
  }
} 
\tikzset{
	slash/.style={postaction={
  	decorate,
    decoration={markings, mark=at position 0.5 with
    	{\draw[-] (.3ex,.3ex) -- (-.3ex,-.3ex);}}}
  }
} 

\tikzset{trees/.style={
	inner sep=0, 
	minimum width=0, 
	minimum height=0,
	level distance=.75cm, 
	sibling distance=.5cm,
%	every child/.style={fill},
	edge from parent/.style={shorten <= 2pt, draw, ->},
	grow'=up,
	decoration={markings, mark=at position 0.75 with \arrow{stealth}}
	}
}


\newcommand{\bito}[1][]{
	\begin{tikzcd}[ampersand replacement=\&, cramped]\ar[r, biml-bimr, "#1"]\&~\end{tikzcd}  
}
\newcommand{\bifrom}[1][]{
	\begin{tikzcd}[ampersand replacement=\&, cramped]\ar[r, bimr-biml, "{#1}"]\&~\end{tikzcd}  
}
\newcommand{\bifromlong}[2][]{
	\begin{tikzcd}[ampersand replacement=\&, column sep=#2, cramped]\ar[r, bimr-biml, "#1"]\&~\end{tikzcd}  
}

% Adjunctions
\newcommand{\adj}[5][30pt]{%[size] Cat L, Left, Right, Cat R.
\begin{tikzcd}[ampersand replacement=\&, column sep=#1]
  #2\ar[r, shift left=7pt, "#3"]
  \ar[r, phantom, "\scriptstyle\Rightarrow"]\&
  #5\ar[l, shift left=7pt, "#4"]
\end{tikzcd}
}

\newcommand{\adjr}[5][30pt]{%[size] Cat R, Right, Left, Cat L.
\begin{tikzcd}[ampersand replacement=\&, column sep=#1]
  #2\ar[r, shift left=7pt, "#3"]\&
  #5\ar[l, shift left=7pt, "#4"]
  \ar[l, phantom, "\scriptstyle\Leftarrow"]
\end{tikzcd}
}

\newcommand{\xtickar}[1]{\begin{tikzcd}[baseline=-0.5ex,cramped,sep=small,ampersand 
replacement=\&]{}\ar[r,tick, "{#1}"]\&{}\end{tikzcd}}
\newcommand{\xslashar}[1]{\begin{tikzcd}[baseline=-0.5ex,cramped,sep=small,ampersand 
replacement=\&]{}\ar[r,tick, "{#1}"]\&{}\end{tikzcd}}



  
  % amsthm %
\theoremstyle{definition}
\newtheorem{definitionx}{Definition}[chapter]
\newtheorem{examplex}[definitionx]{Example}
\newtheorem{remarkx}[definitionx]{Remark}
\newtheorem{notation}[definitionx]{Notation}


\theoremstyle{plain}

\newtheorem{theorem}[definitionx]{Theorem}
\newtheorem{proposition}[definitionx]{Proposition}
\newtheorem{corollary}[definitionx]{Corollary}
\newtheorem{lemma}[definitionx]{Lemma}
\newtheorem{warning}[definitionx]{Warning}
\newtheorem*{theorem*}{Theorem}
\newtheorem*{proposition*}{Proposition}
\newtheorem*{corollary*}{Corollary}
\newtheorem*{lemma*}{Lemma}
\newtheorem*{warning*}{Warning}
%\theoremstyle{definition}
%\newtheorem{definition}[theorem]{Definition}
%\newtheorem{construction}[theorem]{Construction}

\newenvironment{example}
  {\pushQED{\qed}\renewcommand{\qedsymbol}{$\lozenge$}\examplex}
  {\popQED\endexamplex}
  
 \newenvironment{remark}
  {\pushQED{\qed}\renewcommand{\qedsymbol}{$\lozenge$}\remarkx}
  {\popQED\endremarkx}
  
  \newenvironment{definition}
  {\pushQED{\qed}\renewcommand{\qedsymbol}{$\lozenge$}\definitionx}
  {\popQED\enddefinitionx} 

    
%-------- Single symbols --------%
	
\DeclareSymbolFont{stmry}{U}{stmry}{m}{n}
\DeclareMathSymbol\fatsemi\mathop{stmry}{"23}

\DeclareFontFamily{U}{mathx}{\hyphenchar\font45}
\DeclareFontShape{U}{mathx}{m}{n}{
      <5> <6> <7> <8> <9> <10>
      <10.95> <12> <14.4> <17.28> <20.74> <24.88>
      mathx10
      }{}
\DeclareSymbolFont{mathx}{U}{mathx}{m}{n}
\DeclareFontSubstitution{U}{mathx}{m}{n}
\DeclareMathAccent{\widecheck}{0}{mathx}{"71}


%-------- Renewed commands --------%

\renewcommand{\ss}{\subseteq}

%-------- Other Macros --------%


\DeclarePairedDelimiter{\present}{\langle}{\rangle}
\DeclarePairedDelimiter{\copair}{[}{]}
\DeclarePairedDelimiter{\floor}{\lfloor}{\rfloor}
\DeclarePairedDelimiter{\ceil}{\lceil}{\rceil}
\DeclarePairedDelimiter{\corners}{\ulcorner}{\urcorner}
\DeclarePairedDelimiter{\ihom}{[}{]}

\DeclareMathOperator{\Hom}{Hom}
\DeclareMathOperator{\Mor}{Mor}
\DeclareMathOperator{\dom}{dom}
\DeclareMathOperator{\cod}{cod}
\DeclareMathOperator{\idy}{idy}
\DeclareMathOperator{\comp}{com}
\DeclareMathOperator*{\colim}{colim}
\DeclareMathOperator{\im}{im}
\DeclareMathOperator{\ob}{Ob}
\DeclareMathOperator{\Tr}{Tr}
\DeclareMathOperator{\el}{El}




\newcommand{\const}[1]{\texttt{#1}}%a constant, or named element of a set
\newcommand{\Set}[1]{\mathsf{#1}}%a named set
\newcommand{\ord}[1]{\mathsf{#1}}%an ordinal
\newcommand{\cat}[1]{\mathcal{#1}}%a generic category
\newcommand{\Cat}[1]{\mathbf{#1}}%a named category
\newcommand{\fun}[1]{\mathrm{#1}}%a function
\newcommand{\Fun}[1]{\mathrm{#1}}%a named functor




\newcommand{\id}{\mathrm{id}}
\newcommand{\then}{\mathbin{\fatsemi}}

\newcommand{\cocolon}{:\!}


\newcommand{\iso}{\cong}
\newcommand{\too}{\longrightarrow}
\newcommand{\tto}{\rightrightarrows}
\newcommand{\To}[2][]{\xrightarrow[#1]{#2}}
\renewcommand{\Mapsto}[1]{\xmapsto{#1}}
\newcommand{\Tto}[3][13pt]{\begin{tikzcd}[sep=#1, cramped, ampersand replacement=\&, text height=1ex, text depth=.3ex]\ar[r, shift left=2pt, "#2"]\ar[r, shift right=2pt, "#3"']\&{}\end{tikzcd}}
\newcommand{\Too}[1]{\xrightarrow{\;\;#1\;\;}}
\newcommand{\from}{\leftarrow}
\newcommand{\ffrom}{\leftleftarrows}
\newcommand{\From}[1]{\xleftarrow{#1}}
\newcommand{\Fromm}[1]{\xleftarrow{\;\;#1\;\;}}
\newcommand{\surj}{\twoheadrightarrow}
\newcommand{\inj}{\rightarrowtail}
\newcommand{\wavyto}{\rightsquigarrow}
\newcommand{\lollipop}{\multimap}
\newcommand{\imp}{\Rightarrow}
\renewcommand{\iff}{\Leftrightarrow}
\newcommand{\down}{\mathbin{\downarrow}}
\newcommand{\fromto}{\leftrightarrows}
\newcommand{\tickar}{\xtickar{}}
\newcommand{\slashar}{\xslashar{}}



\newcommand{\inv}{^{-1}}
\newcommand{\op}{^\tn{op}}

\newcommand{\tn}[1]{\textnormal{#1}}
\newcommand{\ol}[1]{\overline{#1}}
\newcommand{\ul}[1]{\underline{#1}}
\newcommand{\wt}[1]{\widetilde{#1}}
\newcommand{\wh}[1]{\widehat{#1}}
\newcommand{\wc}[1]{\widecheck{#1}}
\newcommand{\ubar}[1]{\underaccent{\bar}{#1}}

\newcommand{\dual}[1]{{#1}^\vee}



\newcommand{\bb}{\mathbb{B}}
\newcommand{\cc}{\mathbb{C}}
\newcommand{\nn}{\mathbb{N}}
\newcommand{\pp}{\mathbb{P}}
\newcommand{\qq}{\mathbb{Q}}
\newcommand{\zz}{\mathbb{Z}}
\newcommand{\rr}{\mathbb{R}}


\newcommand{\finset}{\Cat{Fin}}
\newcommand{\smset}{\Cat{Set}}
\newcommand{\smcat}{\Cat{Cat}}
\newcommand{\catsharp}{\Cat{Cat}^{\sharp}}
\newcommand{\oorg}{\mathbb{O}\Cat{rg}}
\newcommand{\ppolyfun}{\mathbb{P}\Cat{olyFun}}
\newcommand{\ccatsharp}{\mathbb{C}\Cat{at}^{\sharp}}
\newcommand{\ccatsharpdisc}{\mathbb{C}\Cat{at}^{\sharp}_{\tn{disc}}}
\newcommand{\ccatsharplin}{\mathbb{C}\Cat{at}^{\sharp}_{\tn{lin}}}
\newcommand{\ccatsharpdisccon}{\mathbb{C}\Cat{at}^{\sharp}_{\tn{disc,con}}}
\newcommand{\sspan}{\mathbb{S}\Cat{pan}}
\newcommand{\polyfin}{\poly_{\finset}}
\newcommand{\Mod}{\Cat{Mod}}

\newcommand{\List}{\Fun{List}}
\newcommand{\set}{\tn{-}\Cat{Set}}

\newcommand{\plpl}{\mathbin{+\!\!+}}


\newcommand{\yon}{\mathcal{y}}
\newcommand{\poly}{\Cat{Poly}}
\newcommand{\tri}{\mathbin{\triangleleft}}
\newcommand{\tripow}[1]{^{\tri #1}}
\newcommand{\free}{\mathfrak{m}}
\newcommand{\cofree}{\mathfrak{c}}
\newcommand{\Cofree}{\mathfrak{C}}
\newcommand{\tree}{\Set{Tree}}
\newcommand{\diag}{\Cat{Diag}}
\newcommand{\VEF}{\Cat{VEF}}

\newcommand{\rt}{\texttt{root}}
\newcommand{\br}{\tn{\texttt{branch}}}
\newcommand{\hd}{\texttt{head}}
\newcommand{\tl}{\texttt{tail}}

% lenses
\newcommand{\biglens}[2]{
     \begin{bmatrix}{\vphantom{f_f^f}#2} \\ {\vphantom{f_f^f}#1} \end{bmatrix}
}
\newcommand{\littlelens}[2]{
     \begin{bsmallmatrix}{\vphantom{f}#2} \\ {\vphantom{f}#1} \end{bsmallmatrix}
}
\newcommand{\lens}[2]{
  \relax\if@display
     \biglens{#1}{#2}
  \else
     \littlelens{#1}{#2}
  \fi
}

\newcommand{\myred}[1]{{\color{red!80!black}#1}}


\newcommand{\qand}{\quad\text{and}\quad}
\newcommand{\qqand}{\qquad\text{and}\qquad}


\newcommand{\coto}{\nrightarrow}
\newcommand{\cofun}{{\raisebox{2pt}{\resizebox{2.5pt}{2.5pt}{$\setminus$}}}}
\newcommand{\coh}[1]{^{(#1)}}
\newcommand{\hoc}[1]{_{(#1)}}

\newcommand{\coalg}{\tn{-}\Cat{Coalg}}

\newcommand{\bic}[2]{{}_{#1}\Cat{Comod}_{#2}}

% ---- Changeable document parameters ---- %

\linespread{1.1}
%\allowdisplaybreaks
\setsecnumdepth{section}
\settocdepth{section}
\setlength{\parindent}{15pt}
\setcounter{tocdepth}{1}



%--------------- Document ---------------%
\begin{document}

\title{The free monad monad as a module over\\the cofree comonad comonad in $\poly$}

\author{David I. Spivak}

\date{\vspace{-.2in}}

\maketitle

\begin{abstract}


\smallskip

\noindent
\textbf{Keywords:} 
\end{abstract}


%-------- Chapter --------%
\chapter{Introduction}

Both the free monad construction $\free$ and the cofree comonad construction $\cofree$ are functors endofunctors $\poly\to\poly$ on the category of polynomial functors; each is fascinating in its own right, and the two constructions are related in surprising ways. Both have something to do with trees. Given a polynomial $p:\poly$, the free monad $\free_p$ on $p$ is something like an operad, whereas the cofree comonad $\cofree_p$ is a category.

To begin to get a handle on these, one might think of $\free_p$ in terms of syntax trees. For example, suppose $p$ is given by
\[
p\coloneqq\{\myred{+}, \myred{\times}\}\yon^2+\{\myred{-}\}\yon+\{\myred{0},\myred{1}\}
\]
Then an example element of $\free_p(0)$ is the following tree:
\[
\begin{tikzpicture}[trees,
  level 1/.style={sibling distance=10mm},
  level 2/.style={sibling distance=5mm},
  level 3/.style={sibling distance=2.5mm}]
	\node (a) {$\myred{\times}$}
		child {node {$\myred{+}$}
			child {node {$\myred{1}$}}
			child {node {$\myred{1}$}}
		}
		child {node {$\myred{1}$}}
		;
\end{tikzpicture}
\]
which represents the expression $(1+1)\times 1$. By Lambek's theorem there is a function $\free_p(0)\to\cofree_p(1)$, and this function is injective, so we can also see any syntax tree as an element of $\cofree_p(1)$ as well. However, more general elements of $\cofree_p(1)$ may have infinite height. We will explain in the next section. 

In fact, the free monad construction $p\mapsto\free_p$ is itself a monad on $\poly$. That is, there are natural unit and multiplication maps
\[
	\eta_p\colon p\to\free_p
	\qqand
	\mu_p\colon \free_{\free_p}\to\free_p,
\]
satisfying the usual monad laws. Similarly, the cofree comonad construction $p\to\cofree_p$ is itself a comonad on $\poly$, meaning there are natural counit and comultiplication maps
\[
	\epsilon_p\colon\cofree_p\to p
	\qqand
	\delta_p\colon\cofree_p\to\cofree_{\cofree_p},
\]
satisfying the usual comonad laws. Moreover, $\cofree$ is lax monoidal on $(\poly,\yon,\otimes)$ with unitor and productor denoted:
\[
  \upsilon\colon\yon\to\cofree_\yon
  \qqand
	\pi_{p,q}\colon\cofree_p\otimes\cofree_q\to\cofree_{p\otimes q}.
\]

The above is well-known. In this note, we provide what appears to be a novel relationship between the two constructions and the Dirichlet tensor product $\otimes$ on $\poly$. In particular, for any polynomials $p,q$, there is a natural map
\[
  \Phi_{p,q}\colon\free_p\otimes\cofree_q\to\free_{p\otimes q}
\]
This map presents $\free$ as a \emph{module} over $\cofree$, as \cite{https://ncatlab.org/nlab/show/module+over+a+monoidal+functor}, because it satisfies the action laws for $\cofree$'s lax monoidal structure ($\upsilon,\pi$):
%\[
%\begin{tikzcd}
%	\free_p\otimes\yon\ar[r,equal]\ar[d, "\free_p\otimes\upsilon"']&
%	\free_p\ar[d, equal]\\
%	\free_p\otimes\cofree_\yon\ar[r, "\Phi_{p,\yon}"']&
%	\free_{p\otimes\yon}
%\end{tikzcd}
%\hspace{.6in}
%\begin{tikzcd}[column sep=large]
%	\free_p\otimes\cofree_q\otimes\cofree_{q'}\ar[r, "\Phi_{p,q}\otimes\cofree_{q'}"]\ar[d, "\free_p\otimes\pi_{q,q'}"']&
%	\free_{p\otimes q}\otimes\cofree_{q'}\ar[d, "\Phi_{p\otimes q,q'}"]\\
%	\free_p\otimes\cofree_{q\otimes q'}\ar[r, "\Phi_{p,q\otimes q'}"']&
%	\free_{p\otimes q\otimes q'}
%\end{tikzcd}
%\]
\[
\begin{tikzcd}
	\free_p\otimes\yon\ar[r,equal]\ar[d]&
	\free_p\ar[d, equal]\\
	\free_p\otimes\cofree_\yon\ar[r]&
	\free_{p\otimes\yon}
\end{tikzcd}
\hspace{.6in}
\begin{tikzcd}[column sep=large]
	\free_p\otimes\cofree_q\otimes\cofree_{q'}\ar[r]\ar[d]&
	\free_{p\otimes q}\otimes\cofree_{q'}\ar[d]\\
	\free_p\otimes\cofree_{q\otimes q'}\ar[r]&
	\free_{p\otimes q\otimes q'}
\end{tikzcd}
\]
But it also satisfies additional coherence laws for interactions between $\eta_p$ and $\epsilon_q$ and between $\mu_p$ and $\delta_q$:
\[
\begin{tikzcd}
  p\otimes\cofree_q\ar[r]\ar[d]&p\otimes q\ar[d]\\
  \free_p\otimes\cofree_q\ar[r]&\free_{p\otimes q}
\end{tikzcd}
\hspace{.6in}
\begin{tikzcd}
	\free_{\free_p}\otimes\cofree_q\ar[d]\ar[r]&
	\free_{\free_p}\otimes\cofree_{\cofree_q}\ar[r]&
	\free_{\free_p\otimes\cofree_q}\ar[r]&
	\free_{\free_{p\otimes q}}\ar[d]\\
	\free_p\otimes\cofree_q\ar[rrr]&&&
	\free_{p\otimes q}
\end{tikzcd}
\]


The above is all quite abstract, until when one considers it in terms of trees. The map $\Phi_{p,q}$ can be understood as follows:...



Moore machines and Mealy machines....

%---- Section ----%
\section{Notation for polynomial functors}

$p(1)$.

\section*{Acknowledgments}
The author thanks Brandon Shapiro for many useful conversations.

This material is based upon work supported by the Air Force Office of Scientific Research under award number FA9550-20-1-0348.

%-------- Chapter --------%
\chapter{The cofree comonad comonad $\cofree$}

%---- Section ----%
\section{Behavior trees and initialized coalgebras}

Let $p:\poly$ be a polynomial functor. To understand the cofree comonad $\cofree_p$ on it, one begins with the following definition.

\begin{definition}
Let $p:\poly$ be a polynomial functor. The set $\tree_p$ of \emph{$p$-behavior trees} is defined coinductively as follows. An element $T:\tree_p$ consists of a pair $(I,T.)$ where $I:p(1)$ is a position of $p$ and $T\then -\colon p[I]\to\tree_p$ is a function, i.e.\ for each $i:p[I]$ it returns $T\then i:\tree_p$. 
We refer to $I$ as the \emph{root} of $T$ and denote it $T.\rt$, we write $T.\br\coloneqq p[I]$ and refer to each $i:T.\br$ as a \emph{$T$-branch}, the function $T\then-$ as the \emph{following function}, and the tree $T\then i$ as the \emph{$p$-behavior tree following $i$}.
\end{definition}

\begin{example}
Here is a table of $\tree_p$'s for various polynomials $p$ arising from sets $A,B:\smset$.
\[
\begin{array}{l|l|l}
p:\poly&\tree_p&\text{Comment}\\\hline
A&A&\text{$A$-constant trees: $A$-many roots, no branches}\\
A\yon&A^\nn&\text{$A$-Streams: $A$-many roots, one branch each}\\
A\yon+B&A^\nn+B\List(A)&\text{$A$-streams that can terminate in a $B$}\\
A\yon^B&A^{\List(B)}&\text{$B$-branching $A$-trees: print an $A$ and branch by $B$}
\end{array}
\]
\end{example}

\begin{definition}[Cofree category $\Cofree_p$]
Let $p:\poly$ be a polynomial. Consider the graph with vertices $\tree_p$ and for any $T:\tree_p$ a single outgoing edge for each $i:T.\br$, whose target vertex is $T\then i$. Define the \emph{cofree category on $p$}, denoted $\Cofree_p$ to be the free category on that graph.

For any $T:\ob(\Cofree_p)$, we denote the set of outgoing morphisms (paths in the underlying graph) by
\[
\Cofree_p[T]\coloneqq\sum_{T':\tree_p}\Cofree_p(T,T').
\qedhere
\]
\end{definition}

The following is straightforward.
\begin{lemma}
Let $p:\poly$ and $T:\tree_p$ a $p$-behavior tree. Then an element of $\Cofree_p[T]$ can be identified with a list $(i_1,\cdots,i_n)$ where
\[
i_1:T.\br,\quad
i_2:(T\then i_1).\br,\quad...\quad
i_n:(T\then i_1\then\ldots\then i_{n-1}).\br.
\]
The codomain function $\cod\colon\Cofree_p[T]\to\tree_p$ acts on an element $\ell\coloneqq(i_1,\ldots,i_n):\Cofree_p[T]$ by 
\[
\cod\ell\coloneqq T\then i_1\then\cdots\then i_n.
\]
In particular, $\Cofree_p(T,T')\cong\{\ell\colon\Cofree_p[T]\mid\cod(\ell)=T'\}$. 

The identity on $T$ is identified with the length-0 list $()$. Given morphisms $\ell\colon T\to T'$ and $\ell'\colon T'\to T''$ in $\Cofree_p$, their composite, denoted $(\ell\plpl\ell')\colon T\to T''$, is given by concatenation.
\end{lemma}

There is a map $T.\br\to\Cofree_p[T]$ given by sending branches to length-1 lists $i\mapsto (i)$. We will use $\cod$ and $\plpl$ to denote their restriction along this map. In particular, given $\ell\colon T\to T'$ and $i:T'.\br$, we denote their composite by $\ell\plpl i\coloneqq\ell\plpl(i)$.

\begin{definition}
A $p$-coalgebra is a pair $(S,f)$ where $S:\smset$ and $f\colon S\to p(S)$. We refer to elements $s:S$ as \emph{states}. Given a state $s:S$, we can identify $f(s):p(S)$ with a pair
\[
f(s)=(\hd_{f,s},\tl_{f,s}),\quad\text{where}\quad \hd_{f,s}:p(1)\text{ and } \tl_{f,s}\colon p[I]\to S
\]

We refer to a $p$-algebra equipped with a state $s:S$ as an \emph{intialized $p$-coalgebra} and denote it $(S,f,s)$.
 
A \emph{morphism} of $p$-coalgebras $(S,f)\to(S',f')$ consists of a function $g\colon S\to S'$ such that the following diagram commutes:
\[
\begin{tikzcd}
	S\ar[r, "f"]\ar[d, "g"']&p(S)\ar[d, "p(g)"]\\
	S'\ar[r, "f'"']&p(S')
\end{tikzcd}
\]
In particular, the following equations hold:
\[
(\hd_{f,s}=\hd_{f',g(s)}):p(1)
\qqand
(g\circ\tl_{f,s}=\tl_{f',g(s)})\colon p[\hd_{f,s}]\to S'.
\]
A \emph{morphism $(S,f,s)\to(S',f',s')$ of intitialized $p$-coalgebras} is a morphism $g$ of $p$-coalgebras, such that $g(s)=s'$. 

We denote the category of $p$-coalgebras by $p\coalg$ and that of initialized $p$-coalgebras by $p\coalg_*$.
\end{definition}

\begin{proposition}
There is a retraction of categories
\[
\tree_p\To{A} p\coalg_*\To{B}\tree_p,\]
where $\tree_p:\smset$ is considered as a discrete category.
\end{proposition}
\begin{proof}
Given a $p$-tree $T:\tree_p$, consider the set $\Cofree_p[T]:\smset$ of outgoing paths and the element $():\Cofree_p[T]$ given by the $0$-length path. Consider the function $(\cod,\plpl)\colon \Cofree_p[T]\to p(\Cofree_p[T])$, which sends $\ell$ to $(\cod\ell,i\mapsto \ell\plpl(i))$.
Then
\[A(T)\coloneqq(\Cofree_p[T],(\cod,\plpl),())\]
is an initialized $p$-coalgebra.

We now give a functor from $B\colon p\coalg$ to $\tree_p$. On objects, $B$ sends an initialized $p$-coalgebra $(S,f,s)$ to the $p$-behavior tree defined coinductively as
\[
	B(S,f,s)\coloneqq(\hd_{f,s},B(S,f,\tl_{f,s}))
\]
In other words, its root is $\hd_{f,s}:p(1)$ and for any branch $i:p[\hd_{f,s}]$, the $p$-behavior tree following $i$ is $B(S,f,\tl_{f,s}(i))$. Given a morphism $g\colon (S,f,s)\to (S',f',g(s))$, we show $B(S,f,s)=B(S',f',g(s))$ coinductively: the base case is $\hd_{f,s}=\hd_{f',s'}$ and the coinductive step is
\[
B(S,f,\tl_{f,s})=B(S',f',g\circ\tl_{f,s})=B(S',f',\tl_{f',g(s)}).
\]
Thus every morphism in $p\coalg_*$ is sent to an identity. 

The composite of $A$ and $B$ is clearly identity on $\tree_p$ because $\hd_{(\cod,\plpl),()}=\cod()=T.\rt$ and $\tl_{(\cod,\plpl),()}(i)=()\plpl i=T\then i$.
\end{proof}

\begin{proposition}
There is a functor $\cofree_-\colon\poly\to\poly$ such that $\cofree_p$ has the structure of a $\tri$-comonoid for each $p:\poly$,
\[
\cofree_p\to\yon
\qqand
\cofree_p\to\cofree_p\tri\cofree_p.
\qedhere
\]
\end{proposition}
\begin{proof}
Given a polynomial $p$, define polynomials $p^{(i)}$ for $i\in\nn$ by
\[
  p\coh{0}\coloneqq\yon
  \qqand
  p\coh{1+i}\coloneqq\yon\times\left(p\tri p\coh{i}\right)
\]
There is a projection map $\pi\coh{0}\colon p\coh{1}\to p\coh{0}$, and if $\pi\coh{i}\colon p\coh{1+i}\to p\coh{i}$ has been defined, then we can define $\pi\coh{1+i}\coloneqq \yon\times(p\tri\pi\coh{i})$. Now define the polynomial
\begin{equation}\label{eqn.construct_cofree}
\cofree_p\coloneqq\lim\big(\cdots\To{\pi\coh{2}}p\coh{2}\To{\pi\coh{1}}p\coh{1}\To{\pi\coh{0}}p\coh{0}\big)
\end{equation}
and we note that this construction $p\mapsto \cofree_p$ is natural in $p:\poly$.

This polynomial comes equipped with a counit $\epsilon\colon\cofree_p\to\yon=p\coh{0}$ given by the projection. We next construct the comultiplication $\delta\colon\cofree_p\to\cofree_p\tri\cofree_p$. Since $\tri$ commutes with connected limits, we have
\[
  \cofree_p\tri\cofree_p=
  \left(\lim_{i_1}p\coh{i_1}\right)\tri\left(\lim_{i_2}p\coh{i_2}\right)\cong
  \lim_{i_1,i_2}\left(p\coh{i_1}\tri p\coh{i_2}\right)
\]
To obtain the comultiplication $\lim_ip\coh{i}\to\lim_{i_1,i_2}(p\coh{i_1}\tri p\coh{i_2})$, it suffices to produce a natural choice of polynomial map $\varphi_{i_1,i_2}\colon p\coh{i_1+i_2}\to p\coh{i_1}\tri p\coh{i_2}$ for any $i_1,i_2:\nn$. When $i_1=0$ or $i_2=0$, we use the unit identity for $\tri$. By induction, assume given $\varphi_{i_1,1+i_2}$; we construct $\varphi_{1+i_1,1+i_2}$ as follows:
\begin{align}
\nonumber
  p\coh{1+i_1+1+i_2}&=
  \yon\times \left(p\tri p\coh{i_1+1+i_2}\right)\\&\to
\label{eqn.induction}
  \yon\times \left(p\tri p\coh{i_1}\tri p\coh{1+i_2}\right)\\&\to
\label{eqn.special}
  \left(\yon\times p\tri p\coh{i_1}\right)\tri p\coh{1+i_2}\\&=
\nonumber
  p\coh{1+i_1}\tri p\coh{1+i_2}
\end{align}
where \eqref{eqn.induction} is $\varphi_{i_1,1+i_2}$ and it remains to construct \eqref{eqn.special}. Recall that $-\tri q$ preserves products for any $q$, so constructing \eqref{eqn.special} is equivalent to constructing two maps
\[
\yon\times \left(p\tri p\coh{i_1}\tri p\coh{1+i_2}\right)\To{\phi\coh{i_1,i_2}} p\coh{1+i_2}
\qqand
\yon\times \left(p\tri p\coh{i_1}\tri p\coh{1+i_2}\right)\to p\tri p\coh{i_1}\tri p\coh{1+i_2}.
\]
For the latter we use the second projection. The former, $\phi\coh{i_1,i_2}\colon p\coh{1+i_1+1+i_2}\to p\coh{1+i_2}$, is the more interesting one; for it we also use projections $p\coh{i_1}\to p\coh{0}=\yon$ and $\pi\coh{i_2}\colon p\coh{i_2+1}\to p\coh{i_2}$ to obtain:
\[
\yon\times \left(p\tri p\coh{i_1}\tri p\coh{1+i_2}\right)\to
\yon\times \left(p\tri\yon\tri p\coh{i_2}\right)\cong p\coh{1+i_2}
\]
We leave the naturality of this to the reader.

It remains to check that $\epsilon$ and $\delta$ satisfy unitality and coassociativity. The base cases above imply unitality. Proving coassociativity amounts to proving that the following diagram commutes:
\[
\begin{tikzcd}[column sep=50pt]
	p\coh{1+i_1+1+i_2+1+i_3}\ar[r, "\phi\coh{i_1,i_2+1+i_3}"]\ar[d, "\phi\coh{i_1+1+i_2,i_3}"']&
	p\coh{1+i_2+1+i_3}\ar[d, "\phi\coh{i_2,i_3}"]\\
	p\coh{1+i_3}\ar[r,equal]&p\coh{1+i_3}
\end{tikzcd}
\]
This can be shown by induction on $i_3$.
\end{proof}

\begin{theorem}\label{thm.cofree_comonad_comonad}
There is an adjunction
\[
\adj{\catsharp}{U}{\cofree_-}{\poly}
\]
where $U\colon\catsharp\to\poly$ is the forgetful functor $U(c,\epsilon,\delta)\coloneqq c$.
\end{theorem}
\begin{proof}
We will abuse notation and denote the comonoid $(c,\epsilon,\delta):\catsharp$ simply by its carrier $c$. We first provide the counit and unit of the desired adjunction. The counit
\[
\epsilon_p\colon\cofree_p\to p
\]
is given by composing the projection map $\cofree_p\to p\coh{1}$ from construction \eqref{eqn.construct_cofree} with the projection $p\coh{1}\cong\yon\times p\to p$. Since $\cofree_c$ is defined as a limit, the unit
\[
\eta_c\colon c\coto\cofree_c
\]
will be given by defining maps $\eta\coh{i}\colon c\to c\coh{i}$ commuting with the projections $\pi\coh{i}\colon c\coh{1+i}\to c\coh{i}$, for each $i:\nn$, and then showing that the resulting polynomial map $\eta_c$ is indeed a cofunctor. Noting that $c\coh{0}=\yon$, we define
\[
\eta\coh{0}\coloneqq\epsilon
\]
Given $\eta\coh{i}\colon c\to c\coh{i}$, we define $\eta\coh{1+i}$ as the composite
\[
c\To{(\epsilon,\delta)}\yon\times(c\tri c)\To{\yon\times(c\tri\eta\coh{i})}\yon\times\left(c\tri c\coh{i}\right)=c\coh{1+i}.
\]
Clearly, we have $\eta\coh{0}=\pi\coh{0}\circ\eta\coh{1}$. It is easy to check that if $\eta\coh{i}=\pi\coh{i}\circ\eta\coh{1+i}$ then $\eta\coh{1+i}=\pi\coh{1+i}\circ\eta\coh{2+i}$. Thus we have constructed a polynomial map $\eta\colon c\to \cofree_c$. It clearly commutes with the counit, so it suffices to show that $\eta$ commutes with the comultiplication, which amounts to showing that the following diagram commutes
\[
\begin{tikzcd}
  c\ar[r, "\delta"]\ar[d, "{(\epsilon,\delta)}"']&[27pt]
  c\tri c\ar[r, "{(\epsilon,\delta)\tri(\epsilon,\delta)}"]&[15pt]
  \big(\yon\times(c\tri c)\big)\tri\big(\yon\times(c\tri c)\big)\ar[d, "{(\yon\times c\tri\eta\coh{i_1})\tri(\yon\times c\tri\eta\coh{i_2})}"]\\
  \yon\times(c\tri c)\ar[r, "{\yon\times c\tri\eta\coh{i_1+1+i_2}}"']&
  \yon\times(c\tri c\coh{i_1+1+i_2})\ar[r, "\varphi_{1+i_1,1+i_2}"']&
  \big(\yon\times(c\tri c\coh{i_1})\big)\tri\big(\yon\times(c\tri c\coh{i_2})\big)
\end{tikzcd}
\]
for all $i_1,i_2:\nn$, where $\varphi_{1+i_1,1+i_2}$ is the map constructed in \cref{eqn.induction,eqn.special}. Commutativity follows from the counitality and coassociativity of the comonoid $c$.

The triangle identities are straightforward as well. Indeed, for any comonoid $c:\catsharp$, the composite $c\To{U\circ\eta_c} \cofree_c\To{\epsilon_{Uc}} c$ is equal to the composite of $c\To{(\epsilon,c)}c\coh{1}=\yon\times c$, with the projection $c\coh{1}\to c$, the result of which is the identity. Finally, for any polynomial $p:\poly$, the composite $\cofree_p\To{\eta_{\cofree_p}}\cofree_{\cofree_p}\To{\cofree_{\epsilon_p}}\cofree_p$ is given by taking a limit of maps of the form
\[
	\cofree_p\To{(\epsilon,\delta)}
	\yon\times(\cofree_p\tri\cofree_p)\To{\yon\times(\cofree_p\tri\eta\coh{i})}
	\yon\times(\cofree_p\tri\cofree_p\coh{i})\To{\yon\times(\epsilon_p\tri\epsilon_p\coh{i})}
	\yon\times(p\tri p\coh{i})
\]
Each one is in fact the projection $\cofree_p\to p\coh{i+1}$, so the resulting map is the identity on $\cofree_p$, completing the proof.
\end{proof}


%-------- Chapter --------%
\chapter{The free monad monad $\free$}

\section{The free monad monad on finitary polynomials}

\begin{definition}
A functor $F\colon\smset\to\smset$ is called \emph{finitary} if it commutes with filtered colimits. A polynomial $p:\poly$ is called \emph{finitary} if the set $p[I]$ is finite for all $I:p(1)$. Let $\polyfin\ss\poly$ denote the full subcategory spanned by the finitary polynomials.
\end{definition}

\begin{lemma}
A polynomial $p$ is finitary iff the corresponding functor $X\mapsto p\tri X$ is finitary.
\end{lemma}
\begin{proof}
Since coproducts commute with filtered colimits, and $\poly$ is extensive, the following is a pullback for any $I:p(1)$,
\[
\begin{tikzcd}
	\colim_{j:J}(\yon^{p[I]}\tri X_j)\ar[r]\ar[d]&
	\yon^{p[I]}\tri\colim_{j:J}X_j\ar[d]\\
	\colim_{j:J}(p\tri X_j)\ar[r]&
	p\tri\colim_{j:J}X_j\ar[ul, phantom, very near end, "\lrcorner"]
\end{tikzcd}
\]
and the lower map is the coproduct, taken over all $I:p(1)$, of the corresponding top maps. It follows that the bottom map is an iso iff the top map is for all $I:p(1)$. Thus $p$ is finitary as a functor iff for each $I:p(1)$, the map $X\mapsto X^{p[I]}$ is finitary. But $\yon^A\colon\smset\to\smset$ is finitary iff $A$ is finite because finite limits, hence finite products, commute with filtered colimits, and because not every map $A\to\nn$ factors through some finite stage $A\to N\to\nn$. This completes the proof.
\end{proof}

Note that $p+q$ and $p\tri q$ are finitary if $p$ and $q$ are, and that the colimit of finitary polynomials is again finitary.


\begin{proposition}\label{prop.free_monad_fin}
There is a functor $\free_-\colon\polyfin\to\polyfin$ such that $\free_p$ has the structure of a Cartesian $\tri$-monoid for each finitary $p:\polyfin$,
\[
\yon\to\free_p
\qqand
\free_p\tri\free_p\to\free_p.
\qedhere
\]
\end{proposition}
\begin{proof}
For a finitary polynomial $p$, define polynomials $p\hoc{i}$ for $i\in\nn$ by
\[
p\hoc{0}\coloneqq\yon
\qqand
p\hoc{1+i}\coloneqq\yon+\left(p\tri p\hoc{i}\right)
\]
There is a coproduct inclusion $\iota\hoc{0}\colon p\hoc{0}\to p\hoc{1}$, and if $\iota\hoc{i}\colon p\hoc{i}\to p\hoc{i+1}$ has been defined, then we can define $\iota\hoc{1+i}\coloneqq \yon+(p\tri\iota\hoc{i})$. Now define the polynomial
\begin{equation}
	\free_p\coloneqq\colim\left(\cdots\From{\iota\hoc{2}}p\hoc{2}\From{\iota\hoc{1}}p\hoc{1}\From{\iota\hoc{0}}p\hoc{0}\right)
\end{equation}
Note, by induction, that each $p\hoc{i}$ is finitary and that each $\iota\hoc{i}$ is cartesian, hence $\free_p$ is finitary and all maps $p\hoc{i}\to\free_p$ are cartesian. We refer to any composite of $\iota$'s, including the map $p\hoc{i}\to\free_p$, as an \emph{$\iota$-inclusion}.

This polynomial comes equipped with a cartesian unit $\eta\colon\yon=p\hoc{0}\to\cofree_p$. We next construct the multiplication $\mu\colon\free_p\tri\free_p\to\free_p$. The $(-\tri b)$-operation preserves colimits of cartesian maps, and if $a$ is finitary the $(a\tri-)$ operation preserves filtered colimits. Hence we have
\[
	\free_p\tri\free_p=
  \left(\colim_{i_1}p\hoc{i_1}\right)\tri\left(\colim_{i_2}p\hoc{i_2}\right)\cong
  \colim_{i_1,i_2}\left(p\hoc{i_1}\tri p\hoc{i_2}\right).
\]
To obtain the multiplication map $\colim_{i_1,i_2}(p\hoc{i_1}\tri p\hoc{i_2})\to\colim_i p\hoc{i}$, it suffices to produce a natural choice of polynomial maps $\varphi_{i_1,i_2}\colon p\hoc{i_1}\tri p\hoc{i_2}\to p\hoc{i_1+i_2}$ for any $i_1,i_2:\nn$. When $i_1=0$ or $i_2=0$, we use the unit identity for $\tri$. By induction, assume given $\varphi_{i_1,i_2}$; we construct $\varphi_{1+i_1,i_2}$ as follows
\begin{align*}
	p\hoc{1+i_1}\tri p\hoc{i_2}&=
	\left(\yon+p\tri p\hoc{i_1}\right)\tri p\hoc{i_2}\\&\cong
	p\hoc{i_2}+p\tri p\hoc{i_1}\tri p\hoc{i_2}\\&\to
	p\hoc{1+i_1+i_2}+p\tri p\hoc{i_1+i_2}\\&\to
	p\hoc{1+i_1+i_2}
\end{align*}
where the penultimate map is an $\iota$-inclusion on the first summand and $p\tri\varphi_{i_1,i_2}$ on the second summand.

It remains to check that $\eta$ and $\mu$ satisfy unitality and associativity. The base cases above imply unitality. To prove associativity, it suffices to show that the following diagram commutes for all $i_1,i_2,i_3$:
\[
\begin{tikzcd}
	p\hoc{i_1}\tri p\hoc{i_2}\tri p\hoc{i_3}\ar[r]\ar[d]&
	p\hoc{i_1}\tri p\hoc{i_2+i_3}\ar[d]\\
	p\hoc{i_1+i_2}\tri p\hoc{i_3}\ar[r]&
	p\hoc{i_1+i_2+i_3}
\end{tikzcd}
\]
This is shown by a straightforward induction on $i_1$.
\end{proof}

Let $\Mod(\polyfin)$ denote the category monoids in $(\polyfin,\yon,\tri)$; we refer to its objects as \emph{finitary polynomial monads} or simply \emph{monads}. Note that we are not asking objects or morphisms in $\Mod(\polyfin)$, or later $\Mod(\poly)$ to be cartesian; that is a property we will specify explicitly when present.

\begin{lemma}\label{lemma.free_polyfin}
There is an adjunction
\[
\adj{\polyfin}{\free_-}{U}{\Mod(\polyfin)}
\]
where $U\colon\Mod(\polyfin)\to\poly$ is the forgetful functor $U(m,\eta,\mu)\coloneqq m$.
\end{lemma}
\begin{proof}
We will abuse notation and denote the finitary polynomial monad $(m,\eta,\mu):\Mod(\polyfin)$ simply by its carrier $m$. We provide the unit and counit of the desired adjunction. The unit
\[
\eta_p\colon p\to\free_p
\]
is given by composing the coproduct inclusion $p\to\yon+p=p\hoc{1}$ with the $\iota$-inclusion $p\hoc{1}\to\free_{p}$. Since $\free_m$ is defined as a colimit, the counit
\[\epsilon_m\colon\free_m\to m\]
will be given by defining maps $\epsilon\hoc{i}\colon m\hoc{i}\to m$ commuting with inclusions $\iota\hoc{i}\colon m\hoc{i}\to m\hoc{i+1}$ for each $i:\nn$, and then showing that the resulting polynomial map $\epsilon_m$ is indeed a map of monads. Noting that $m\hoc{0}=\yon$, we define
\[
\epsilon\hoc{0}\coloneqq\eta
\]
Given $\epsilon\hoc{i}\colon m\hoc{i}\to m$, we define $\epsilon\hoc{1+i}$ as the composite
\[
	m\hoc{1+i}=
  \yon+\left(m\tri m\hoc{i}\right)\To{\yon+(m\tri\epsilon\hoc{i})}
	\yon+(m\tri m)\To{(\eta,\mu)}
	m.
\]
Clearly, we have $\epsilon\hoc{0}=\epsilon\hoc{1}\circ\iota\hoc{0}$. It is easy to check that if $\epsilon\hoc{i}=\epsilon\hoc{1+i}\circ\iota\hoc{i}$ then $\epsilon\hoc{1+i}=\epsilon\hoc{2+i}\circ\iota\hoc{1+i}$. Thus we have constructed a polynomial map $\epsilon\colon \free_m\to m$. It clearly commutes with the unit, so it remains to show that $\epsilon$ commutes with the multiplication and that $\epsilon$ and $\eta$ satisfy the triangle identities. All this is analogous to the calculation in the proof of \cref{thm.cofree_comonad_comonad}.
\end{proof}

\section{The free monad monad $\free$}

In the previous section we computed $\free_p$ for a finitary polynomial $p:\polyfin$. In this section, we extend the construction to an arbitrary polynomial.

\begin{lemma}\label{lemma.vert_lim}
Every polynomial is canonically isomorphic to the limit of its vertical maps to finitary polynomials.
\end{lemma}
\begin{proof}
Let $p$ be a polynomial, and consider the comma category
\[\VEF_p\coloneqq(\{p\}\down\polyfin^\tn{vert}),\]
of vertical epimorphisms $p\to q$ with $q$ finitary; its objects are polynomials $q$ with the same positions as $p$ and for each $I:p(1)$ a subset $q[I]\ss p[I]$ of the directions. It comes with a functor $\VEF_p\to\poly$ sending $(p\to q)\mapsto q$. There is an orthogonal factorization system on $\poly$ whose left class is vertical epimorphisms. Given an arbitrary map $\varphi\colon p\to p'$ of polynomials, we can take any map $p'\to q'$ and consider the vertical-epimorphic part of the composite $p\to p'\to q'$. Thus we have a diagram of the following form:
\[
\begin{tikzcd}[column sep=0pt]
	\VEF_p\ar[dr, "" name=p]&&\VEF_{p'}\ar[dl, ""' name=p']\ar[ll]\\&
	\poly
	\ar[from=p, to=p', Rightarrow]
\end{tikzcd}
\]
These are precisely the morphisms in the category $\diag_\circ(\poly)$ \cite{peschke2021diagrams}, hence we have a functor $\VEF\colon\poly\to\diag_\circ(\poly)$. Since $\poly$ is complete, taking limits defines a functor $\lim\colon\diag_\circ(\poly)\to\poly$. 

We claim that the composite $\poly\to\diag_\circ(\poly)\to\poly$ is naturally isomorphic to the identity. Since $\poly$ (resp.\ $\polyfin$) is the coproduct completion of $\smset\op$ (resp.\ $\finset\op$), this amounts to the fact that $\finset\to\smset$ is dense, i.e.\ that every set is the colimit of finite sets. 
\end{proof}

\begin{proposition}
There is a functor $\free_-\colon\poly\to\poly$ such that $\free_p$ has the structure of a Cartesian $\tri$-monoid for each finitary $p:\poly$,
\[
\yon\to\free_p
\qqand
\free_p\tri\free_p\to\free_p.
\qedhere
\]
\end{proposition}
\begin{proof}
For $p:\poly$, the functor $\VEF_p\to\poly$ from \cref{lemma.vert_lim} factors through $\VEF_p\to\polyfin$. Composing with $\free_-\colon\polyfin\to\Mod(\polyfin)$ from \cref{lemma.free_polyfin} gives a functor $\VEF_p\to\Mod(\polyfin)$,
sending each $p\to q$ to the monad $(\free_q,\eta_q,\mu_q)$. Define the polynomial
\[\free_p\coloneqq\lim_{(p\to q)\in\VEF_p}\free_q.\]
We will define a unit $\yon\to\free_p$ and a multiplication $\free_p\tri\free_p\to\free_p$ satisfying the usual laws. 

The maps $\eta_q\colon\yon\to\free_q$ assemble into a map to their limit
\[
  \eta\colon\yon\To{(\eta_q)_{q:\VEF_p}}
  \left(\lim_{q:\VEF_p}\free_q\right)=
  \free_p
\]
and one checks by hand that $\eta$ is cartesian. We next claim that there are isomorphisms
\begin{align*}
	\free_p\tri\free_p&\coloneqq
  \left(\lim_{q:\VEF_p}\free_q\right)\tri\left(\lim_{q':\VEF_p}\free_{q'}\right)\\&\cong
  \lim_{q:\VEF_p}\lim_{q':\VEF_p}\free_q\tri\free_{q'}\\&\cong
  \lim_{q:\VEF_p}\free_q\tri\free_q
\end{align*}
\end{proof}

%-------- Chapter --------%
\chapter{The module structure $\free_p\otimes\cofree_q\to\free_{p\otimes q}$}

\chapter{Application: the microservices operad $\oorg^\free$}

\printbibliography
\end{document}
